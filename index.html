<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="appTitle">EduHydro - Home</title>
    <!-- Google Fonts: Poppins for headings, Nunito for body text -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Poppins:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        /* Define pastel color palette and shadows using CSS variables */
        :root {
            --pastel-blue: #A8DADC;
            --pastel-green: #B8E1C4;
            --pastel-yellow: #F9F5A6;
            --text-dark: #333;
            --text-light: #555;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --dark-blue-contrast: #005073; /* New dark blue for contrast */
            --hydra-bot-bg: #E0F2F7; /* Light blue for bot messages */
            --user-message-bg: #D4EDDA; /* Light green for user messages */
        }

        /* Base styles for body */
        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            /* Changed to gradient background with white for brighter feel */
            background: linear-gradient(to bottom right, var(--pastel-blue), white, var(--pastel-green));
            /* New: subtle water ripple pattern for game feel */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="%23FFFFFF" stroke-opacity="0.1" fill="none" stroke-width="1"/><circle cx="50" cy="50" r="30" stroke="%23FFFFFF" stroke-opacity="0.08" fill="none" stroke-width="1"/></svg>');
            background-size: 200px 200px; /* Size of the repeating pattern */
            background-repeat: repeat;
            color: var(--text-dark);
            overflow-x: hidden; /* Prevent horizontal scroll */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Full viewport height */
            position: relative;
        }

        /* Background decorations: ASEAN Map, Water Droplets, River, Turbine */
        /* ASEAN Map (simple pattern for flat/pastel style) */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Using a simple SVG pattern as a placeholder for a flat ASEAN map */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="8" fill="%23B8E1C4"/><circle cx="50" cy="30" r="10" fill="%23A8DADC"/><circle cx="80" cy="25" r="7" fill="%23F9F5A6"/><path d="M10 60 Q 30 50, 50 60 T 90 60" stroke="%23A8DADC" stroke-width="2" fill="none"/><path d="M15 70 Q 35 60, 55 70 T 95 70" stroke="%23B8E1C4" stroke-width="2" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: center bottom;
            background-size: 150%; /* Adjust size for visual effect */
            opacity: 0.1; /* Subtle background */
            z-index: -1; /* Behind content */
        }

        /* Water Droplet Icon (top-right) */
        .water-droplet-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            /* Inline SVG for a clean water droplet icon */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.6;
            z-index: -1;
            animation: float 4s ease-in-out infinite alternate; /* Floating animation */
        }

        /* Turbine Icon (bottom-left) */
        .turbine-icon {
            position: absolute;
            bottom: 120px; /* Above navbar */
            left: 20px;
            width: 40px;
            height: 40px;
            /* Inline SVG for a clean turbine icon */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23B8E1C4"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93V17c0-.55.45-1 1-1s1 .45 1 1v2.93c-2.34-.54-4.13-2.33-4.13-4.66C7.87 11.23 9.49 9.5 11.5 9.5s3.63 1.73 3.63 4.14c0 2.33-1.79 4.12-4.13 4.66zM12 11c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5S13.93 11 12 11z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.5;
            z-index: -1;
            animation: spin 8s linear infinite; /* Spinning animation */
        }

        /* River Icon (top-left) */
        .river-icon {
            position: absolute;
            top: 150px;
            left: 30px;
            width: 35px;
            height: 35px;
            /* Inline SVG for a simple river/flow icon */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M17 5H7c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-1 9h-2v2h2v-2zm-3 0h-2v2h2v-2zm-3 0H8v2h2v-2zm-1-3h-2v2h2v-2zm3 0h-2v2h2v-2zm3 0h-2v2h2v-2z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.6;
            z-index: -1;
            animation: float 5s ease-in-out infinite alternate reverse; /* Floating animation, reversed */
        }

        /* New: Electricity/Lightning Icon (top-right, near turbine) */
        .electricity-icon {
            position: absolute;
            top: 100px;
            right: 40px;
            width: 35px;
            height: 35px;
            /* Inline SVG for a lightning bolt icon */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23F9F5A6"><path d="M11 15H9V9h2v6zm4-6h-2v6h2V9zm-2-7L7.5 7H10v5h4V7h2.5L13 2z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.7;
            z-index: -1;
            animation: pulse 2s infinite ease-in-out; /* Pulsing animation */
        }

        /* Keyframe animations for decorative icons */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* Header Section */
        header {
            padding: 20px;
            text-align: center;
            position: relative;
            background: transparent;
            z-index: 10; /* Ensure header is above background elements */
        }

        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8em;
            font-weight: 700; /* Bold font */
            color: var(--dark-blue-contrast); /* Changed to contrasting dark blue */
            text-shadow: 0 2px 4px var(--shadow-light); /* Subtle text shadow */
            margin: 0;
            padding: 5px 0;
            animation: fadeInDown 1s ease-out; /* Fade in from top */
            position: relative; /* Needed for water animation behind */
            display: inline-block; /* To contain the pseudo-element */
        }

        /* Water looping animation behind EduHydro title */
        .app-title::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%; /* Wider than title */
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><path fill="%23A8DADC" opacity="0.5" d="M0,10 C30,15 70,5 100,10 L100,20 L0,20 Z" /><path fill="%23B8E1C4" opacity="0.5" d="M0,12 C30,17 70,7 100,12 L100,20 L0,20 Z" /></svg>'); /* Simple wavy pattern */
            background-size: 50% 100%; /* Repeat pattern horizontally */
            background-repeat: repeat-x;
            transform: translate(-50%, -50%);
            z-index: -1; /* Behind the text */
            animation: waterLoop 10s linear infinite; /* Looping animation */
        }

        @keyframes waterLoop {
            from { background-position: 0 0; }
            to { background-position: 100% 0; }
        }

        .tagline {
            font-family: 'Poppins', sans-serif;
            font-size: 0.9em;
            font-style: italic;
            color: var(--text-light);
            margin-top: 5px;
            margin-bottom: 20px; /* Add margin below tagline before search bar */
            animation: fadeIn 1.5s ease-out 0.5s forwards; /* Fade in after title */
            opacity: 0; /* Start invisible */
        }

        /* Header Search Bar Container */
        #header-search-bar-container {
            position: relative;
            width: calc(100% - 40px);
            max-width: 500px; /* Limit search bar width */
            margin: 0 auto;
            animation: fadeInUp 1s ease-out 1s forwards; /* Fade in from bottom after tagline */
            opacity: 0; /* Start invisible */
            display: flex; /* Ensure it's a flex container for icon alignment */
            align-items: center;
        }

        .search-bar {
            width: 100%;
            padding: 12px 15px 12px 45px; /* Added left padding for icon */
            border: none;
            border-radius: 25px; /* Rounded corners */
            box-shadow: 0 4px 8px var(--shadow-light); /* Soft shadow */
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            color: var(--text-dark);
            background-color: white;
            transition: box-shadow 0.3s ease, transform 0.2s ease; /* Smooth transition for focus and subtle scale */
        }

        .search-bar:focus {
            outline: none;
            box-shadow: 0 6px 12px var(--shadow-medium); /* Enhanced shadow on focus */
            transform: scale(1.01); /* Subtle scale on focus */
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            fill: var(--text-light); /* Icon color */
        }

        /* Keyframe animations for header elements */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Water Wave Shape (Top separator) */
        .water-wave-top {
            width: 100%;
            height: 50px;
            /* Background now transparent to show body gradient */
            background: transparent;
            position: relative;
            margin-top: -20px; /* Overlap with header for seamless transition */
            z-index: 5;
            overflow: hidden; /* Hide overflow of the pseudo-element */
        }

        .water-wave-top::before {
            content: '';
            position: absolute;
            width: 200%; /* Wider than parent to create curve */
            height: 100%;
            background: var(--pastel-green); /* Color of the next section */
            top: 0;
            left: -50%;
            border-radius: 0 0 50% 50%; /* Creates the wave shape */
            transform: scaleY(0.8); /* Adjust curve intensity */
            animation: wave-top 3s ease-in-out infinite alternate; /* Subtle animation */
        }

        @keyframes wave-top {
            0% { transform: scaleY(0.8) translateX(0); }
            100% { transform: scaleY(0.8) translateX(-5%); }
        }

        /* Main Content Section */
        main {
            flex-grow: 1; /* Allows main content to fill available space */
            padding: 20px;
            background-color: var(--pastel-green); /* Background for feature cards */
            position: relative;
            z-index: 1;
            padding-bottom: 80px; /* Space for fixed navbar */
        }

        .app-section {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            margin-bottom: 20px;
            text-align: center;
            display: none; /* Hidden by default */
        }

        .app-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8em;
            color: var(--dark-blue-contrast);
            margin-bottom: 20px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: 1fr; /* Single column for mobile */
            gap: 15px; /* Spacing between cards */
        }

        .feature-card {
            background-color: white;
            border-radius: 20px; /* Rounded corners for cards */
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light); /* Soft shadow */
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, scale 0.3s ease, border 0.3s ease; /* Smooth hover effects, added scale and border */
            cursor: pointer;
            position: relative;
            overflow: hidden; /* Hide ripple overflow */
            animation: slideInUp 0.8s ease-out forwards; /* Slide in from bottom */
            opacity: 0; /* Start invisible */
        }

        /* Delay animation for each card */
        .feature-card:nth-child(1) { animation-delay: 1.5s; }
        .feature-card:nth-child(2) { animation-delay: 1.7s; }
        .feature-card:nth-child(3) { animation-delay: 1.9s; }
        .feature-card:nth-child(4) { animation-delay: 2.1s; }
        .feature-card:nth-child(5) { animation-delay: 2.3s; }


        .feature-card:hover {
            transform: translateY(-5px) scale(1.02); /* Lift and subtle scale effect on hover */
            box-shadow: 0 10px 25px var(--shadow-medium); /* Slightly more pronounced shadow */
            border: 2px solid var(--pastel-blue); /* Add a subtle border on hover */
        }

        .feature-card-icon {
            width: 60px;
            height: 60px;
            background-color: var(--pastel-yellow); /* Icon background */
            border-radius: 50%; /* Circular icon background */
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em; /* Icon size */
            color: var(--text-dark);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s ease; /* Smooth transition for icon bounce */
            position: relative; /* For sparkle effect */
            overflow: hidden; /* For sparkle effect */
        }

        /* Sparkle animation for card icons - adjusted for smoothness and speed */
        .feature-card-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%; /* Start further left */
            width: 60%; /* Wider sparkle */
            height: 100%;
            background: rgba(255, 255, 255, 0.3); /* Softer white sparkle */
            transform: skewX(-20deg);
            animation: sparkle 4s infinite ease-in-out; /* Slower and smoother */
        }

        @keyframes sparkle {
            0% { left: -100%; }
            50% { left: 150%; } /* Move further right */
            100% { left: -100%; }
        }


        .feature-card:hover .feature-card-icon {
            transform: translateY(-5px); /* Icon subtle bounce on card hover */
        }

        .feature-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .feature-card p {
            font-family: 'Nunito', sans-serif;
            font-size: 0.9em;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Water ripple effect for cards on hover */
        .feature-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(168, 218, 220, 0.3); /* Pastel blue ripple */
            border-radius: 50%;
            opacity: 0;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease-out, height 0.4s ease-out, opacity 0.4s ease-out;
            z-index: 0; /* Behind card content */
        }

        .feature-card:hover::before {
            width: 250px; /* Expand ripple */
            height: 250px;
            opacity: 1;
        }
        /* Ensure card content is above the ripple effect */
        .feature-card > * {
            position: relative;
            z-index: 1;
        }

        /* Keyframe animation for feature cards */
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Water Wave Shape (Bottom separator) */
        .water-wave-bottom {
            width: 100%;
            height: 50px;
            background: var(--pastel-green); /* Matches main content background */
            position: relative;
            margin-bottom: -20px; /* Overlap with main content */
            z-index: 5;
            overflow: hidden;
        }

        .water-wave-bottom::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 100%;
            background: var(--pastel-blue); /* Color of the navbar background */
            bottom: 0;
            left: -50%;
            border-radius: 50% 50% 0 0; /* Creates the wave shape */
            transform: scaleY(0.8); /* Adjust curve intensity */
            animation: wave-bottom 3s ease-in-out infinite alternate; /* Subtle animation */
        }

        @keyframes wave-bottom {
            0% { transform: scaleY(0.8) translateX(0); }
            100% { transform: scaleY(0.8) translateX(5%); }
        }

        /* Fixed Bottom Navbar */
        nav.navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            box-shadow: 0 -5px 15px var(--shadow-light); /* Shadow above navbar */
            display: flex;
            justify-content: space-around; /* Distribute items evenly */
            padding: 10px 0;
            border-top-left-radius: 25px; /* Rounded top corners */
            border-top-right-radius: 25px;
            z-index: 1000; /* Ensure navbar is on top of everything */
            animation: slideInUp 0.8s ease-out 2.5s forwards; /* Slide in from bottom after cards */
            opacity: 0; /* Start invisible */
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            text-decoration: none;
            font-family: 'Nunito', sans-serif;
            font-size: 0.8em;
            padding: 5px;
            transition: color 0.3s ease, transform 0.2s ease; /* Smooth color and transform change on hover */
        }

        .nav-item.active {
            color: var(--dark-blue-contrast); /* Active color */
            font-weight: 700;
        }

        .nav-item:hover {
            color: var(--dark-blue-contrast); /* Highlight color on hover */
            transform: translateY(-5px) scale(1.15); /* More pronounced lift and scale on hover */
        }

        .nav-item-icon {
            width: 28px;
            height: 28px;
            margin-bottom: 5px;
            background-color: var(--pastel-green); /* Placeholder icon background */
            border-radius: 50%; /* Circular icon background */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2em;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease; /* Add transition for shadow */
        }

        .nav-item:hover .nav-item-icon,
        .nav-item.active .nav-item-icon {
            background-color: var(--pastel-blue); /* Change icon background on hover/active */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* Add shadow to icon itself */
        }

        /* Language selector styling */
        .language-selector-container {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1001; /* Above other elements */
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 2px 5px var(--shadow-light);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .language-selector-container select {
            border: none;
            background-color: transparent;
            font-family: 'Nunito', sans-serif;
            font-size: 0.85em;
            color: var(--text-dark);
            padding-right: 20px; /* Space for dropdown arrow */
            -webkit-appearance: none; /* Remove default arrow */
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23555"><path d="M7 10l5 5 5-5z"/></svg>'); /* Custom arrow */
            background-repeat: no-repeat;
            background-position: right 5px center;
            background-size: 15px;
            cursor: pointer;
        }

        .language-selector-container select:focus {
            outline: none;
        }


        /* Responsive adjustments for larger screens */
        @media (min-width: 600px) {
            .feature-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Two columns or more for wider screens */
                max-width: 900px; /* Max width for content */
                margin: 0 auto; /* Center the grid */
            }

            #header-search-bar-container {
                max-width: 500px; /* Limit search bar width */
            }
        }

        /* --- New Styles for Profile and Learn Sections --- */
        .profile-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: var(--pastel-blue);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            color: white;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px var(--shadow-light);
        }

        .profile-info p {
            margin: 0;
            font-size: 1em;
            color: var(--text-dark);
        }

        .game-button {
            background-color: var(--pastel-green);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .game-button:hover {
            background-color: var(--dark-blue-contrast);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .learning-categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .category-card {
            background-color: var(--pastel-yellow);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: left;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--shadow-medium);
        }

        .category-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            color: var(--dark-blue-contrast);
            margin-top: 0;
            margin-bottom: 5px;
        }

        .category-card p {
            font-size: 0.85em;
            color: var(--text-light);
        }

        /* Learn Section Search Bar - Card Layout */
        .learn-search-card {
            position: relative;
            width: calc(100% - 40px); /* Full width minus padding */
            max-width: 500px;
            margin: 0 auto 20px auto; /* Center and add bottom margin */
            background-color: white;
            border-radius: 25px; /* Rounded corners for card-like look */
            box-shadow: 0 4px 8px var(--shadow-light);
            display: flex; /* To align icon and input */
            align-items: center;
            padding: 8px 15px; /* Adjust padding for inner elements */
        }

        .learn-search-card .search-icon {
            position: static; /* Remove absolute positioning */
            transform: none; /* Remove transform */
            margin-right: 10px; /* Space between icon and input */
            flex-shrink: 0; /* Prevent icon from shrinking */
        }

        .learn-search-card .search-bar {
            flex-grow: 1; /* Allow input to take remaining space */
            padding: 5px 0; /* Adjust padding */
            border: none;
            box-shadow: none; /* Remove redundant shadow */
            background-color: transparent; /* Transparent background */
        }

        /* New: Mini-Game Section Styles */
        .mini-game-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .mini-game-card {
            background-color: var(--pastel-blue); /* Different background for distinction */
            color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .mini-game-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        .mini-game-card-icon {
            width: 60px;
            height: 60px;
            background-color: white; /* White icon background */
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            color: var(--dark-blue-contrast); /* Dark blue icon */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .mini-game-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 10px;
            color: white;
        }

        .mini-game-card p {
            font-family: 'Nunito', sans-serif;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        /* New: Achievements Section Styles */
        .achievements-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .achievements-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4em;
            color: var(--dark-blue-contrast);
            margin-bottom: 10px;
        }

        .progress-bar-container {
            width: 80%;
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--pastel-green), var(--pastel-blue));
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }

        .badges-grid, .unlockables-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            width: 100%;
            max-width: 400px; /* Limit width for better appearance */
            margin-top: 20px;
        }

        @media (min-width: 480px) {
            .badges-grid, .unlockables-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        .badge-card, .unlockable-item {
            background-color: var(--pastel-yellow);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .badge-card:hover, .unlockable-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--shadow-medium);
        }

        .badge-icon, .unlockable-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--dark-blue-contrast);
        }

        .badge-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 5px;
        }

        .badge-card p, .unlockable-item p {
            font-size: 0.8em;
            color: var(--text-light);
        }

        /* --- ASEAN River Quest Section Styles --- */
        #asean-river-quest-section {
            background-color: var(--pastel-green); /* Base background for the section */
            position: relative;
            overflow: hidden; /* Hide overflow of background elements */
        }

        #asean-river-quest-section .subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* Background water waves for ASEAN River Quest */
        #asean-river-quest-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23A8DADC" opacity="0.2" d="M0,20 Q25,10 50,20 T100,20 V100 H0 Z"/><path fill="%23B8E1C4" opacity="0.2" d="M0,30 Q25,20 50,30 T100,30 V100 H0 Z"/></svg>');
            background-size: 100% 100px; /* Adjust size of waves */
            background-repeat: repeat-x;
            background-position: bottom;
            opacity: 0.5;
            z-index: 0;
        }

        /* Background ASEAN map for ASEAN River Quest */
        #asean-river-quest-section::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 150px; /* Size of the map */
            height: 150px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23F9F5A6" opacity="0.3" d="M50 0 L100 25 L75 100 L25 100 L0 25 Z"/><circle cx="50" cy="50" r="20" fill="%23A8DADC" opacity="0.3"/></svg>'); /* Placeholder for a simple ASEAN map shape */
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.2;
            z-index: 0;
            transform: rotate(10deg); /* Slight rotation */
        }

        .river-quest-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .river-quest-card {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .river-quest-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px var(--shadow-medium);
            border: 2px solid var(--pastel-blue);
        }

        .river-quest-card-icon {
            width: 70px;
            height: 70px;
            background-color: var(--pastel-blue); /* River-themed background */
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .river-quest-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--dark-blue-contrast);
        }

        .river-quest-status {
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-light);
        }

        .river-quest-status.locked {
            color: #FF6B6B; /* Red for locked */
        }

        .river-quest-status.unlocked {
            color: #28a745; /* Green for unlocked */
        }

        .start-quest-button {
            background-color: var(--pastel-green);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .start-quest-button:hover {
            background-color: var(--dark-blue-contrast);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }

        .gameplay-info-box {
            background-color: var(--pastel-yellow);
            border-radius: 15px;
            padding: 15px;
            margin-top: 30px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: left;
            font-style: italic;
            color: var(--text-dark);
            font-size: 0.9em;
        }

        /* --- EduPlay Missions Section Styles --- */
        #eduplay-missions-section {
            background-color: var(--pastel-green); /* Base background for the section */
            position: relative;
            overflow: hidden; /* Hide overflow of background elements */
        }

        #eduplay-missions-section .subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* Background decorative icons for EduPlay Missions section */
        #eduplay-missions-section::before {
            content: '';
            position: absolute;
            top: 50px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23B8E1C4"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93V17c0-.55.45-1 1-1s1 .45 1 1v2.93c-2.34-.54-4.13-2.33-4.13-4.66C7.87 11.23 9.49 9.5 11.5 9.5s3.63 1.73 3.63 4.14c0 2.33-1.79 4.12-4.13 4.66zM12 11c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5S13.93 11 12 11z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.3;
            z-index: 0;
            animation: spin 10s linear infinite;
        }

        #eduplay-missions-section::after {
            content: '';
            position: absolute;
            bottom: 50px;
            right: 30px;
            width: 40px;
            height: 40px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.4;
            z-index: 0;
            animation: float 5s ease-in-out infinite alternate reverse;
        }

        .mission-grid {
            display: grid;
            grid-template-columns: 1fr; /* Single column for mobile */
            gap: 15px;
            max-width: 900px; /* Max width for content */
            margin: 0 auto; /* Center the grid */
        }

        .mission-card {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.8s ease-out forwards;
            opacity: 0;
        }

        /* Delay animation for each card */
        .mission-card:nth-child(1) { animation-delay: 0.2s; }
        .mission-card:nth-child(2) { animation-delay: 0.4s; }
        .mission-card:nth-child(3) { animation-delay: 0.6s; }

        .mission-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px var(--shadow-medium);
            border: 2px solid var(--pastel-blue);
        }

        .mission-card-thumbnail {
            width: 80px;
            height: 80px;
            background-color: var(--pastel-blue); /* Pastel blue background for icon */
            border-radius: 15px; /* Slightly rounded square */
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .mission-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--dark-blue-contrast);
        }

        .mission-difficulty {
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-light);
        }

        .mission-difficulty.easy { color: var(--pastel-green); }
        .mission-difficulty.medium { color: var(--pastel-yellow); }
        .mission-difficulty.hard { color: #FF6B6B; } /* Red for hard */

        .start-button {
            background-color: var(--pastel-green);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .start-button:hover {
            background-color: var(--dark-blue-contrast);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }


        /* Custom Alert Modal */
        #custom-alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1001;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #custom-alert-modal.show {
            opacity: 1;
            visibility: visible;
        }

        #custom-alert-modal > div {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 80%;
            font-family: 'Nunito', sans-serif;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        #custom-alert-modal.show > div {
            transform: translateY(0);
        }

        #alert-message {
            font-size: 1.1em;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        #alert-ok-button {
            background-color: var(--pastel-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }

        #alert-ok-button:hover {
            background-color: var(--dark-blue-contrast);
        }

        /* --- Hydro Learning Hub Section Styles --- */
        #hydro-learning-hub-section {
            background-color: var(--pastel-green); /* Base background for the section */
            position: relative;
            overflow: hidden; /* Hide overflow of background elements */
        }

        #hydro-learning-hub-section .subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* Background decorative elements for Hydro Learning Hub */
        #hydro-learning-hub-section::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); /* Water droplet */
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.4;
            z-index: 0;
            animation: float 4s ease-in-out infinite alternate;
        }

        #hydro-learning-hub-section::after {
            content: '';
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 70px;
            height: 70px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23B8E1C4"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93V17c0-.55.45-1 1-1s1 .45 1 1v2.93c-2.34-.54-4.13-2.33-4.13-4.66C7.87 11.23 9.49 9.5 11.5 9.5s3.63 1.73 3.63 4.14c0 2.33-1.79 4.12-4.13 4.66zM12 11c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5S13.93 11 12 11z"/></svg>'); /* Turbine */
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.3;
            z-index: 0;
            animation: spin 8s linear infinite;
        }

        .explanation-section {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: left;
            position: relative; /* For z-index to be above background */
            z-index: 1;
        }

        .explanation-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .explanation-item:last-child {
            margin-bottom: 0;
        }

        .explanation-icon {
            font-size: 2.2em;
            margin-right: 15px;
            flex-shrink: 0;
            color: var(--pastel-blue);
        }

        .explanation-text h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            color: var(--dark-blue-contrast);
            margin-top: 0;
            margin-bottom: 5px;
        }

        .explanation-text p {
            font-size: 0.9em;
            color: var(--text-light);
            line-height: 1.5;
        }

        .hydropower-simulation-box {
            background-color: var(--pastel-yellow);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            position: relative; /* For z-index to be above background */
            z-index: 1;
        }

        .hydropower-simulation-box h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4em;
            color: var(--dark-blue-contrast);
            margin-bottom: 15px;
        }

        .simulation-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .simulation-controls label {
            font-size: 0.9em;
            color: var(--text-dark);
            font-weight: 700;
        }

        .simulation-controls input[type="range"] {
            width: 80%;
            -webkit-appearance: none;
            height: 8px;
            background: var(--pastel-blue);
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .simulation-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--dark-blue-contrast);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .simulation-controls input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--dark-blue-contrast);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .simulation-output {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--dark-blue-contrast);
            margin-top: 15px;
        }

        .start-simulation-button {
            background-color: var(--pastel-green);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .start-simulation-button:hover {
            background-color: var(--dark-blue-contrast);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }

        /* --- Future Tech Unlocks Section Styles --- */
        #future-tech-unlocks-section {
            background-color: var(--pastel-green); /* Base background for the section */
            position: relative;
            overflow: hidden; /* Hide overflow of background elements */
        }

        #future-tech-unlocks-section .subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* Background futuristic accents */
        #future-tech-unlocks-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><line x1="0" y1="10" x2="100" y2="10" stroke="%23A8DADC" stroke-width="0.5" opacity="0.2"/><line x1="0" y1="30" x2="100" y2="30" stroke="%23B8E1C4" stroke-width="0.5" opacity="0.2"/><line x1="0" y1="50" x2="100" y2="50" stroke="%23A8DADC" stroke-width="0.5" opacity="0.2"/><line x1="0" y1="70" x2="100" y2="70" stroke="%23B8E1C4" stroke-width="0.5" opacity="0.2"/><line x1="0" y1="90" x2="100" y2="90" stroke="%23A8DADC" stroke-width="0.5" opacity="0.2"/></svg>');
            background-size: 100% 100px;
            background-repeat: repeat-y;
            z-index: 0;
            animation: background-pan 20s linear infinite;
        }

        @keyframes background-pan {
            from { background-position: 0 0; }
            to { background-position: 0 100%; }
        }

        .tech-explanation {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: left;
            position: relative;
            z-index: 1;
        }

        .tech-explanation h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            color: var(--dark-blue-contrast);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .tech-explanation p {
            font-size: 0.9em;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .tech-card-grid {
            display: grid;
            grid-template-columns: 1fr; /* Single column for mobile */
            gap: 20px;
            margin-top: 20px;
        }

        .tech-card {
            background-color: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .tech-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px var(--shadow-medium);
            border: 2px solid var(--pastel-blue);
        }

        .tech-card-icon {
            width: 80px;
            height: 80px;
            background-color: var(--pastel-blue);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tech-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--dark-blue-contrast);
        }

        .tech-card p {
            font-size: 0.9em;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .tech-status {
            font-size: 1em;
            font-weight: 700;
            color: var(--text-light);
        }

        .tech-status.locked {
            color: #FF6B6B; /* Red for locked */
        }

        .tech-status.unlocked {
            color: #28a745; /* Green for unlocked */
            /* Glow effect for unlocked cards */
            text-shadow: 0 0 8px rgba(40, 167, 69, 0.6); /* Soft green glow */
            animation: pulse-glow 2s infinite alternate;
        }

        @keyframes pulse-glow {
            0% { text-shadow: 0 0 8px rgba(40, 167, 69, 0.6); }
            100% { text-shadow: 0 0 15px rgba(40, 167, 69, 1); }
        }

        /* Responsive adjustments for larger screens */
        @media (min-width: 600px) {
            .tech-card-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        /* --- Sustainability Score Section Styles --- */
        #sustainability-score-section {
            background-color: var(--pastel-green); /* Dominant green for eco-friendly */
            position: relative;
            overflow: hidden;
        }

        #sustainability-score-section .subtitle {
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* Background decorative icons for Sustainability Score */
        #sustainability-score-section::before {
            content: '';
            position: absolute;
            top: 30px;
            left: 30px;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); /* Water droplet */
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.3;
            z-index: 0;
            animation: float 4s ease-in-out infinite alternate;
        }

        #sustainability-score-section::after {
            content: '';
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23B8E1C4"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); /* Leaf (using a generic circle, could be a leaf SVG) */
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.4;
            z-index: 0;
            animation: spin 8s linear infinite reverse;
        }

        .score-summary-card {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .score-summary-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5em;
            color: var(--dark-blue-contrast);
            margin-bottom: 15px;
        }

        .overall-progress-container {
            width: 80%;
            max-width: 400px;
            background-color: #e0e0e0;
            border-radius: 15px;
            height: 25px;
            margin: 0 auto 15px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .overall-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--pastel-green), var(--pastel-blue));
            border-radius: 15px;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            box-sizing: border-box;
        }

        .overall-score-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: var(--dark-blue-contrast);
            font-size: 1.1em;
            z-index: 2;
        }

        .overall-score-message {
            font-size: 0.9em;
            color: var(--text-light);
            margin-top: 10px;
        }

        .category-scores-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .category-scores-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        .category-score-card {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            z-index: 1;
        }

        .category-score-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--shadow-medium);
        }

        .category-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--pastel-blue);
        }

        .category-score-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            color: var(--dark-blue-contrast);
            margin-top: 0;
            margin-bottom: 5px;
        }

        .score-value {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--pastel-green);
            margin-bottom: 5px;
        }

        .score-detail {
            font-size: 0.8em;
            color: var(--text-light);
        }

        .leaderboard-card {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .leaderboard-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5em;
            color: var(--dark-blue-contrast);
            margin-bottom: 15px;
        }

        .leaderboard-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .leaderboard-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
            color: var(--text-dark);
        }

        .leaderboard-list li:last-child {
            border-bottom: none;
        }

        .leaderboard-list li span:first-child {
            font-weight: 700;
            color: var(--dark-blue-contrast);
            width: 25%; /* For rank/icon */
            text-align: left;
        }

        .leaderboard-list li .player-name {
            flex-grow: 1;
            text-align: left;
            padding-left: 10px;
        }

        .leaderboard-list li span:last-child {
            font-weight: 700;
            color: var(--pastel-green);
        }

        /* Chart icon for background */
        #sustainability-score-section::before {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23B8E1C4"><path d="M16 11V3H8v8H2v10h20V11h-6zm-6 0V5h4v6h-4zm-6 8v-6h2v6H4zm16 0h-2v-6h2v6z"/></svg>'); /* Bar chart icon */
            opacity: 0.2;
            top: unset;
            bottom: 20px;
            left: 20px;
            width: 70px;
            height: 70px;
            animation: float 5s ease-in-out infinite alternate;
        }

        #sustainability-score-section::after {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23A8DADC"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); /* Water droplet icon */
            opacity: 0.3;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            animation: float 4s ease-in-out infinite alternate reverse;
        }

        /* --- Hydra Bot Section Styles --- */
        #hydra-bot-section {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: calc(100vh - 180px); /* Adjust height to fit screen and navbar/header */
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 5px 15px var(--shadow-light);
        }

        #hydra-bot-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8em;
            color: var(--dark-blue-contrast);
            margin-bottom: 20px;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            border-radius: 15px;
            background-color: #f8f8f8;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .chat-message {
            display: flex;
            align-items: flex-start;
            max-width: 85%;
        }

        .chat-message.user {
            align-self: flex-end;
            justify-content: flex-end;
        }

        .chat-message.bot {
            align-self: flex-start;
            justify-content: flex-start;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            color: white;
            flex-shrink: 0;
        }

        .chat-message.user .message-avatar {
            background-color: var(--dark-blue-contrast);
            margin-left: 10px;
        }

        .chat-message.bot .message-avatar {
            background-color: var(--pastel-blue);
            margin-right: 10px;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.95em;
            line-height: 1.4;
            word-wrap: break-word; /* Ensure long words wrap */
        }

        .chat-message.user .message-content {
            background-color: var(--user-message-bg);
            color: var(--text-dark);
        }

        .chat-message.bot .message-content {
            background-color: var(--hydra-bot-bg);
            color: var(--text-dark);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
            resize: none; /* Prevent vertical resizing */
            min-height: 40px; /* Ensure a minimum height */
            box-sizing: border-box; /* Include padding in height */
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--pastel-blue);
            box-shadow: 0 0 5px rgba(168, 218, 220, 0.5);
        }

        .send-button {
            background-color: var(--pastel-green);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-shrink: 0; /* Prevent button from shrinking */
        }

        .send-button:hover {
            background-color: var(--dark-blue-contrast);
            transform: translateY(-2px);
        }

        .send-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .loading-indicator {
            text-align: center;
            padding: 10px;
            font-style: italic;
            color: var(--text-light);
            display: none; /* Hidden by default */
        }

        /* Responsive adjustments for larger screens */
        @media (min-width: 600px) {
            .app-title {
                font-size: 3.5em;
            }
            .tagline {
                font-size: 1.1em;
            }
            .app-section h2 {
                font-size: 2.2em;
            }
            .feature-card h3, .mini-game-card h3, .tech-card h3, .leaderboard-card h3 {
                font-size: 1.6em;
            }
            .feature-card p, .mini-game-card p, .tech-card p {
                font-size: 1em;
            }
            .nav-item {
                font-size: 0.9em;
            }
            .nav-item-icon {
                width: 35px;
                height: 35px;
                font-size: 1.5em;
            }
            .language-selector-container select {
                font-size: 0.95em;
            }
            .explanation-text h3 {
                font-size: 1.3em;
            }
            .explanation-text p {
                font-size: 1em;
            }
            .hydropower-simulation-box h3 {
                font-size: 1.6em;
            }
            .simulation-controls label {
                font-size: 1em;
            }
            .simulation-output {
                font-size: 1.4em;
            }
            .tech-explanation h3 {
                font-size: 1.3em;
            }
            .tech-explanation p {
                font-size: 1em;
            }
            .score-summary-card h3 {
                font-size: 1.8em;
            }
            .overall-score-text {
                font-size: 1.3em;
            }
            .overall-score-message {
                font-size: 1em;
            }
            .category-score-card h4 {
                font-size: 1.2em;
            }
            .score-value {
                font-size: 1.3em;
            }
            .score-detail {
                font-size: 0.9em;
            }
            .leaderboard-list li {
                font-size: 1em;
            }
            /* Hydra Bot specific adjustments for larger screens */
            #hydra-bot-section {
                height: calc(100vh - 160px); /* Slightly less height on larger screens */
                padding: 30px;
            }
            .chat-messages {
                padding: 20px;
            }
            .message-content {
                font-size: 1em;
            }
            .chat-input {
                padding: 15px;
            }
            .send-button {
                padding: 15px 25px;
            }
        }

        @media (min-width: 768px) { /* Tablet and larger */
            main {
                padding: 30px;
            }
            .app-section {
                padding: 30px;
            }
            .feature-grid, .river-quest-grid, .mission-grid, .mini-game-grid, .tech-card-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
            .learning-categories, .badges-grid, .unlockables-grid, .category-scores-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
            .profile-info {
                flex-direction: row;
                justify-content: center;
                gap: 30px;
            }
            .profile-avatar {
                width: 100px;
                height: 100px;
                font-size: 4em;
            }
            .game-button {
                padding: 12px 25px;
                font-size: 1.1em;
            }
            .explanation-item {
                align-items: center;
            }
            .explanation-icon {
                font-size: 2.5em;
            }
            .simulation-controls {
                flex-direction: row;
                justify-content: center;
                gap: 20px;
            }
            .simulation-controls input[type="range"] {
                width: 60%;
            }
            /* Hydra Bot specific adjustments for tablets */
            #hydra-bot-section {
                padding: 40px;
            }
        }

        @media (min-width: 1024px) { /* Desktop and larger */
            main {
                padding: 40px;
                max-width: 1200px; /* Max width for overall content */
                margin: 0 auto;
            }
            .app-section {
                padding: 40px;
            }
            .feature-grid {
                grid-template-columns: repeat(5, 1fr); /* 5 columns for home features */
                max-width: none; /* Remove max-width for this grid */
            }
            .river-quest-grid, .mission-grid, .mini-game-grid, .tech-card-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .learning-categories, .badges-grid, .unlockables-grid, .category-scores-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
            .language-selector-container {
                top: 20px;
                right: 30px;
                padding: 8px 15px;
            }
            .language-selector-container select {
                font-size: 1em;
            }
            /* Hydra Bot specific adjustments for desktop */
            #hydra-bot-section {
                height: calc(100vh - 120px); /* Further adjust height */
                max-width: 900px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector-container">
        <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="#555555">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H6v2H3v2h-.01l-.02.01c-.71 2.35-1.95 4.58-3.72 6.54l2.54 2.51.03.03c-1.74 1.94-2.98 4.17-3.71 6.53H7v2h7v-2h3v-2h.01l.02-.01c.71-2.35 1.95-4.58 3.72-6.54zM12 18c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
        </svg>
        <select id="language-selector">
            <option value="en">English</option>
            <option value="id">Bahasa Indonesia</option>
            <option value="ms">Bahasa Malaysia</option>
            <!-- Add more languages here -->
            <!-- <option value="th">Thai</option> -->
            <!-- <option value="vi">Vietnamese</option> -->
            <!-- <option value="fil">Filipino</option> -->
        </select>
    </div>

    <!-- Decorative Icons (General App Background) -->
    <div class="water-droplet-icon"></div>
    <div class="turbine-icon"></div>
    <div class="river-icon"></div>
    <div class="electricity-icon"></div>

    <header>
        <h1 class="app-title" data-lang-key="appTitle">EduHydro</h1>
        <p class="tagline" data-lang-key="tagline"><i>Play to Learn, Learn to Power ASEANs Future</i></p>
        <!-- Header Search bar container -->
        <div id="header-search-bar-container" class="search-bar-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            <input type="search" id="header-search-bar" class="search-bar" data-lang-placeholder-key="searchPlaceholder">
        </div>
    </header>

    <!-- Top Water Wave Separator -->
    <div class="water-wave-top"></div>

    <main>
        <!-- Home Section (Feature Grid) -->
        <section id="home-section" class="feature-grid">
            <div class="feature-card" data-feature="asean-river-quest-section">
                <div class="feature-card-icon"></div>
                <h3 data-lang-key="aseanRiverQuest">ASEAN River Quest</h3>
                <p data-lang-key="exploreRivers">Jelajahi sungai ikonik ASEAN sambil menyelesaikan tantangan lokal.</p>
            </div>
            <div class="feature-card" data-feature="eduplay-missions-section">
                <div class="feature-card-icon"></div>
                <h3 data-lang-key="eduplayMissions">EduPlay Missions</h3>
                <p data-lang-key="gamifiedLearning">Pembelajaran gamifikasi dengan misi interaktif tentang tenaga air.</p>
            </div>
            <div class="feature-card" data-feature="hydro-learning-hub-section">
                <div class="feature-card-icon"></div>
                <h3 data-lang-key="hydroLearningHub">Hydro Learning Hub</h3>
                <p data-lang-key="learnScience">Pusat pengetahuan dalam game dengan mini-simulasi.</p>
            </div>
            <div class="feature-card" data-feature="future-tech-unlocks-section">
                <div class="feature-card-icon"></div>
                <h3 data-lang-key="futureTechUnlocks">Future Tech Unlocks</h3>
                <p data-lang-key="unlockInnovative">Buka teknologi AI Turbines dan Floating Micro-Hydro.</p>
            </div>
            <div class="feature-card" data-feature="sustainability-score-section">
                <div class="feature-card-icon"></div>
                <h3 data-lang-key="sustainabilityScore">Sustainability Score</h3>
                <p data-lang-key="yourImpact">Sistem poin yang memberi reward untuk keputusan ramah lingkungan.</p>
            </div>
        </section>

        <!-- ASEAN River Quest Section -->
        <section id="asean-river-quest-section" class="app-section">
            <h2 data-lang-key="aseanRiverQuest">ASEAN River Quest</h2>
            <p class="subtitle" data-lang-key="exploreRivers">Explore iconic rivers while solving community & environmental challenges.</p>
            <div class="river-quest-grid">
                <div class="river-quest-card">
                    <div class="river-quest-card-icon"></div>
                    <h3 data-lang-key="mekongRiver">Sungai Mekong</h3>
                    <p class="river-quest-status unlocked" data-lang-key="unlocked">Unlocked</p>
                    <button class="start-quest-button" data-lang-key="startQuest">Mulai Quest</button>
                </div>
                <div class="river-quest-card">
                    <div class="river-quest-card-icon"></div>
                    <h3 data-lang-key="kapuasRiver">Sungai Kapuas</h3>
                    <p class="river-quest-status locked" data-lang-key="locked">Locked</p>
                    <button class="start-quest-button" disabled data-lang-key="locked">Terkunci</button>
                </div>
                <div class="river-quest-card">
                    <div class="river-quest-card-icon"></div>
                    <h3 data-lang-key="chaoPhrayaRiver">Sungai Chao Phraya</h3>
                    <p class="river-quest-status locked" data-lang-key="locked">Locked</p>
                    <button class="start-quest-button" disabled data-lang-key="locked">Terkunci</button>
                </div>
                <div class="river-quest-card">
                    <div class="river-quest-card-icon"></div>
                    <h3 data-lang-key="irrawaddyRiver">Sungai Irrawaddy</h3>
                    <p class="river-quest-status locked" data-lang-key="locked">Locked</p>
                    <button class="start-quest-button" disabled data-lang-key="locked">Terkunci</button>
                </div>
            </div>
            <div class="gameplay-info-box">
                <p data-lang-key="gameplayTips">Tips: Seimbangkan produksi energi, ekosistem, dan kebutuhan komunitas untuk memenangkan *quest*.</p>
            </div>
        </section>

        <!-- EduPlay Missions Section (Integrated) -->
        <section id="eduplay-missions-section" class="app-section">
            <h2 data-lang-key="eduplayMissions">EduPlay Missions</h2>
            <p class="subtitle" data-lang-key="gamifiedLearning">Gamified learning with interactive hydropower tasks.</p>
            <div class="mission-grid">
                <div class="mission-card">
                    <div class="mission-card-thumbnail"></div>
                    <h3 data-lang-key="buildTurbine">Bangun Turbin Pertama Anda</h3>
                    <p class="mission-difficulty easy" data-lang-key="difficultyEasy">Tingkat Kesulitan: Mudah</p>
                    <button class="start-button" data-lang-key="startMission">Mulai Misi</button>
                </div>
                <div class="mission-card">
                    <div class="mission-card-thumbnail"></div>
                    <h3 data-lang-key="balanceEnergyEco">Seimbangkan Energi & Ekosistem</h3>
                    <p class="mission-difficulty medium" data-lang-key="difficultyMedium">Tingkat Kesulitan: Sedang</p>
                    <button class="start-button" data-lang-key="startMission">Mulai Misi</button>
                </div>
                <div class="mission-card">
                    <div class="mission-card-thumbnail"></div>
                    <h3 data-lang-key="powerVillage">Memberi Daya Desa</h3>
                    <p class="mission-difficulty hard" data-lang-key="difficultyHard">Tingkat Kesulitan: Sulit</p>
                    <button class="start-button" data-lang-key="startMission">Mulai Misi</button>
                </div>
            </div>
        </section>

        <!-- Hydro Learning Hub Section (Integrated) -->
        <section id="hydro-learning-hub-section" class="app-section">
            <h2 data-lang-key="hydroLearningHub">Hydro Learning Hub</h2>
            <p class="subtitle" data-lang-key="learnScience">Learn the science behind clean energy before starting your missions.</p>

            <div class="explanation-section">
                <div class="explanation-item">
                    <div class="explanation-icon"></div>
                    <div class="explanation-text">
                        <h3 data-lang-key="whatIsHydropower">Apa itu Hydropower?</h3>
                        <p data-lang-key="hydropowerDesc">Hydropower adalah energi bersih yang dihasilkan dari kekuatan air yang mengalir. Ini adalah sumber daya terbarukan yang memanfaatkan siklus air alami.</p>
                    </div>
                </div>
                <div class="explanation-item">
                    <div class="explanation-icon"></div>
                    <div class="explanation-text">
                        <h3 data-lang-key="usesOfHydropower">Kegunaan Hydropower</h3>
                        <p data-lang-key="usesDesc">Hydropower berperan penting dalam menyediakan listrik bersih, mengurangi emisi karbon, dan mendukung keberlanjutan. Ini juga membantu pengelolaan air dan irigasi.</p>
                    </div>
                </div>
                <div class="explanation-item">
                    <div class="explanation-icon"></div>
                    <div class="explanation-text">
                        <h3 data-lang-key="howItWorks">Bagaimana Cara Kerja?</h3>
                        <p data-lang-key="howItWorksDesc">Air yang mengalir dari ketinggian memutar turbin. Turbin ini terhubung ke generator yang mengubah energi putaran menjadi listrik.</p>
                    </div>
                </div>
            </div>

            <div class="hydropower-simulation-box">
                <h3 data-lang-key="hydroSimTitle">Simulasi Pembangkit Tenaga Air</h3>
                <p data-lang-key="hydroSimDesc">Atur kecepatan aliran air dan lihat bagaimana turbin berputar untuk menghasilkan listrik.</p>
                <div class="simulation-controls">
                    <label for="water-flow-speed" data-lang-key="waterFlowSpeed">Kecepatan Aliran Air:</label>
                    <input type="range" id="water-flow-speed" min="0" max="100" value="50">
                    <button class="start-simulation-button" id="start-simulation" data-lang-key="startSimulation">Mulai Simulasi</button>
                </div>
                <div class="simulation-output" data-lang-key="electricityOutput">Output Listrik: <span id="kwh-output">0</span> <span data-lang-key="kwh">kWh</span></div>
            </div>
        </section>

        <!-- Future Tech Unlocks Section (New) -->
        <section id="future-tech-unlocks-section" class="app-section">
            <h2 data-lang-key="futureTechUnlocks">Future Tech Unlocks</h2>
            <p class="subtitle" data-lang-key="unlockInnovative">Unlock innovative clean energy technology.</p>

            <div class="tech-explanation">
                <h3 data-lang-key="whatIsAITurbines">Apa itu AI Turbines?</h3>
                <p data-lang-key="aiTurbinesDesc"><strong>AI Turbines</strong> adalah turbin tenaga air yang dilengkapi dengan kecerdasan buatan. AI menganalisis data aliran air, cuaca, dan permintaan energi secara real-time untuk mengoptimalkan kinerja turbin, memaksimalkan produksi listrik, dan meminimalkan dampak lingkungan.</p>
                <h3 data-lang-key="whatIsFloatingMicroHydro">Apa itu Floating Micro-Hydro?</h3>
                <p data-lang-key="floatingMicroHydroDesc"><strong>Floating Micro-Hydro</strong> adalah sistem pembangkit listrik tenaga air skala kecil yang dirancang untuk mengapung di sungai atau kanal. Teknologi ini ideal untuk komunitas terpencil karena mudah dipasang, minim infrastruktur, dan memiliki dampak lingkungan yang sangat rendah.</p>
            </div>

            <div class="tech-card-grid">
                <div class="tech-card">
                    <div class="tech-card-icon"></div>
                    <h3 data-lang-key="aiTurbines">AI Turbines</h3>
                    <p data-lang-key="aiTurbinesDescShort">Turbin pintar yang mengoptimalkan produksi energi dengan AI.</p>
                    <p class="tech-status unlocked" data-lang-key="unlocked">Unlocked</p>
                </div>
                <div class="tech-card">
                    <div class="tech-card-icon"></div>
                    <h3 data-lang-key="floatingMicroHydro">Floating Micro-Hydro</h3>
                    <p data-lang-key="floatingMicroHydroDescShort">Pembangkit listrik tenaga air apung untuk komunitas terpencil.</p>
                    <p class="tech-status locked" data-lang-key="locked">Locked</p>
                </div>
            </div>
        </section>

        <!-- Sustainability Score Section (New) -->
        <section id="sustainability-score-section" class="app-section">
            <h2 data-lang-key="sustainabilityScore">Sustainability Score</h2>
            <p class="subtitle" data-lang-key="yourImpact">Your impact on energy, ecosystem, and community.</p>

            <div class="score-summary-card">
                <h3 data-lang-key="yourSustainabilityScore">Skor Keberlanjutan Anda</h3>
                <div class="overall-progress-container">
                    <div class="overall-progress-bar" style="width: 75%;"></div>
                    <span class="overall-score-text">75%</span>
                </div>
                <p class="overall-score-message" data-lang-key="keepImproving">Terus tingkatkan dampak positif Anda!</p>
            </div>

            <div class="category-scores-grid">
                <div class="category-score-card">
                    <div class="category-icon"></div>
                    <h4 data-lang-key="energyBalance">Keseimbangan Energi</h4>
                    <p class="score-value">85 <span data-lang-key="points">Poin</span></p>
                    <p class="score-detail" data-lang-key="optimalTurbine">Optimalisasi turbin & konsumsi.</p>
                </div>
                <div class="category-score-card">
                    <div class="category-icon"></div>
                    <h4 data-lang-key="ecosystemHealth">Kesehatan Ekosistem</h4>
                    <p class="score-value">70 <span data-lang-key="points">Poin</span></p>
                    <p class="score-detail" data-lang-key="minimizeEnvImpact">Minimalkan dampak lingkungan.</p>
                </div>
                <div class="category-score-card">
                    <div class="category-icon"></div>
                    <h4 data-lang-key="communityImpact">Dampak Komunitas</h4>
                    <p class="score-value">90 <span data-lang-key="points">Poin</span></p>
                    <p class="score-detail" data-lang-key="supportCommunity">Dukung kebutuhan & kesejahteraan.</p>
                </div>
            </div>

            <div class="leaderboard-card">
                <h3 data-lang-key="topLeaderboard">Papan Peringkat Teratas</h3>
                <ul class="leaderboard-list">
                    <li> <span class="player-name" data-lang-key="playerGreat">Pemain Hebat</span> - 980 <span data-lang-key="points">Poin</span></li>
                    <li> <span class="player-name" data-lang-key="ecoWarrior">EcoWarrior</span> - 950 <span data-lang-key="points">Poin</span></li>
                    <li> <span class="player-name" data-lang-key="hydroHero">HydroHero</span> - 920 <span data-lang-key="points">Poin</span></li>
                    <li>4. <span class="player-name" data-lang-key="greenPower">GreenPower</span> - 890 <span data-lang-key="points">Poin</span></li>
                    <li>5. <span class="player-name" data-lang-key="you">Anda</span> - 850 <span data-lang-key="points">Poin</span></li>
                </ul>
            </div>
        </section>

        <!-- Profile Section (Initially hidden) -->
        <section id="profile-section" class="app-section">
            <h2 data-lang-key="profileUser">Profil Pengguna</h2>
            <div class="profile-info">
                <div class="profile-avatar"></div>
                <p><strong data-lang-key="userName">Nama:</strong> <span data-lang-key="profileName">Pemain EduHydro</span></p>
                <p><strong data-lang-key="userLevel">Level:</strong> <span data-lang-key="levelValue">Ahli Hidro</span></p>
                <p><strong data-lang-key="sustainabilityPoints">Poin Keberlanjutan:</strong> <span id="sustainability-points">1250</span></p>
                <button class="game-button" data-lang-key="editProfile">Edit Profil</button>
                <button class="game-button" data-lang-key="logout">Keluar</button>
            </div>
        </section>

        <!-- Learn Section (Initially hidden) -->
        <section id="learn-section" class="app-section">
            <h2 data-lang-key="learningCenter">Pusat Pembelajaran</h2>
            <!-- Learn Section Search Bar - Card Layout -->
            <div class="learn-search-card">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <input type="search" id="learn-search-bar" class="search-bar" data-lang-placeholder-key="searchLearningTopics">
            </div>
            <div class="learning-categories">
                <div class="category-card">
                    <h3 data-lang-key="aseanEnergy">ASEAN & Energi</h3>
                    <p data-lang-key="exploreAseanEnergy">Jelajahi hubungan energi dan keberlanjutan di Asia Tenggara.</p>
                </div>
                <div class="category-card">
                    <h3 data-lang-key="renewableEnergy">Energi Terbarukan</h3>
                    <p data-lang-key="learnCleanEnergy">Pelajari berbagai sumber energi bersih dan inovasinya.</p>
                </div>
                <div class="category-card">
                    <h3 data-lang-key="hydropowerTopic">Tenaga Air (Hydropower)</h3>
                    <p data-lang-key="understandHydropower">Pahami bagaimana air menghasilkan listrik dan dampaknya.</p>
                </div>
                <div class="category-card">
                    <h3 data-lang-key="futureTechTopic">Teknologi Masa Depan</h3>
                    <p data-lang-key="learnAITurbines">Mengenal AI Turbines dan Floating Micro-Hidro.</p>
                </div>
            </div>
        </section>

        <!-- New: Mini-Games Section (Initially hidden) -->
        <section id="mini-games-section" class="app-section">
            <h2 data-lang-key="miniGames">Mini-Game Interaktif</h2>
            <div class="mini-game-grid">
                <div class="mini-game-card">
                    <div class="mini-game-card-icon"></div>
                    <h3 data-lang-key="damConstructionSim">Simulasi Pembangunan Bendungan</h3>
                    <p data-lang-key="chooseMaterials">Pilih material, lokasi, dan lihat dampak aliran air pada pembangkit listrik.</p>
                </div>
                <div class="mini-game-card">
                    <div class="mini-game-card-icon"></div>
                    <h3 data-lang-key="waterFlowPuzzle">Puzzle Aliran Air</h3>
                    <p data-lang-key="guideWater">Arahkan air melalui jalur yang benar untuk mengaktifkan turbin dan menghasilkan listrik.</p>
                </div>
            </div>
        </section>

        <!-- New: Achievements Section (Initially hidden) -->
        <section id="achievements-section" class="app-section">
            <h2 data-lang-key="achievementsLevel">Prestasi & Level</h2>
            <div class="achievements-content">
                <h3 data-lang-key="yourLevel">Level Anda: <span id="user-level">Pelajar Dasar</span></h3>
                <p><span data-lang-key="sustainabilityPoints">Poin Keberlanjutan:</span> <span id="sustainability-points-achievements">1250</span></p>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 50%;"></div> <!-- Example progress -->
                </div>
                <p data-lang-key="completeMissions">Selesaikan misi untuk naik level!</p>

                <h3 data-lang-key="yourBadges">Lencana Anda</h3>
                <div class="badges-grid">
                    <div class="badge-card">
                        <div class="badge-icon"></div>
                        <h4 data-lang-key="riverExplorer">Penjelajah Sungai</h4>
                        <p data-lang-key="completeQuests">Selesaikan 3 Quest Sungai ASEAN.</p>
                    </div>
                    <div class="badge-card">
                        <div class="badge-icon"></div>
                        <h4 data-lang-key="energyExpert">Pakar Energi</h4>
                        <p data-lang-key="answerQuizzes">Jawab 10 kuis dengan sempurna.</p>
                    </div>
                    <div class="badge-card">
                        <div class="badge-icon"></div>
                        <h4 data-lang-key="hydroInnovator">Inovator Hidro</h4>
                        <p data-lang-key="unlockAllTech">Buka semua Teknologi Masa Depan.</p>
                    </div>
                </div>

                <h3 data-lang-key="unlockables">Unlockables</h3>
                <div class="unlockables-grid">
                    <div class="unlockable-item">
                        <div class="unlockable-icon"></div>
                        <p data-lang-key="rainforestTheme">Tema Profil Hutan Hujan</p>
                    </div>
                    <div class="unlockable-item">
                        <div class="unlockable-icon"></div>
                        <p data-lang-key="seniorResearcherAvatar">Avatar Peneliti Senior</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hydra Bot Section (New) -->
        <section id="hydra-bot-section" class="app-section">
            <h2 data-lang-key="hydraBotTitle">Hydra Bot</h2>
            <div class="chat-messages" id="chat-messages">
                <!-- Initial bot message -->
                <div class="chat-message bot">
                    <div class="message-avatar"></div>
                    <div class="message-content" data-lang-key="hydraWelcomeMessage">Halo! Saya Hydra, bot AI EduHydro Anda. Tanyakan apa saja tentang energi air atau ASEAN!</div>
                </div>
            </div>
            <div class="loading-indicator" id="loading-indicator" data-lang-key="hydraTyping">Hydra sedang mengetik...</div>
            <div class="chat-input-container">
                <textarea id="chat-input" class="chat-input" rows="1" data-lang-placeholder-key="askHydraPlaceholder"></textarea>
                <button id="send-button" class="send-button" data-lang-key="sendButton">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF">
                        <path d="M0 0h24v24H0V0z" fill="none"/>
                        <path d="M2.01 21.01L23 12 2.01 3 2 10l15 2-15 2 .01 7z"/>
                    </svg>
                </button>
            </div>
        </section>
    </main>

    <!-- Bottom Water Wave Separator -->
    <div class="water-wave-bottom"></div>

    <!-- Fixed Bottom Navbar -->
    <nav class="navbar">
        <a href="#" class="nav-item" data-section="home-section">
            <div class="nav-item-icon"></div>
            <span data-lang-key="home">Home</span>
        </a>
        <a href="#" class="nav-item" data-section="eduplay-missions-section"> 
            <div class="nav-item-icon"></div>
            <span data-lang-key="play">Play</span>
        </a>
        <a href="#" class="nav-item" data-section="learn-section">
            <div class="nav-item-icon"></div>
            <span data-lang-key="learn">Learn</span>
        </a>
        <a href="#" class="nav-item" data-section="hydra-bot-section">
            <div class="nav-item-icon"></div>
            <span data-lang-key="hydraBotNav">Hydra Bot</span>
        </a>
        <a href="#" class="nav-item" data-section="profile-section">
            <div class="nav-item-icon"></div>
            <span data-lang-key="profile">Profile</span>
        </a>
    </nav>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal">
        <div>
            <p id="alert-message"></p>
            <button id="alert-ok-button" data-lang-key="okButton">OK</button>
        </div>
    </div>

    <script>
        const languageData = {
            en: {
                appTitle: "EduHydro",
                tagline: "Play to Learn, Learn to Power ASEANs Future",
                searchPlaceholder: "Search features or topics...",
                home: "Home",
                play: "Play",
                learn: "Learn",
                profile: "Profile",
                aseanRiverQuest: "ASEAN River Quest",
                exploreRivers: "Explore iconic rivers while solving community & environmental challenges.",
                mekongRiver: "Mekong River",
                unlocked: "Unlocked",
                locked: "Locked",
                startQuest: "Start Quest",
                kapuasRiver: "Kapuas River",
                chaoPhrayaRiver: "Chao Phraya River",
                irrawaddyRiver: "Irrawaddy River",
                gameplayTips: "Tips: Balance energy production, ecosystems, and community needs to win quests.",
                eduplayMissions: "EduPlay Missions",
                gamifiedLearning: "Gamified learning with interactive hydropower tasks.",
                buildTurbine: "Build Your First Turbine",
                difficultyEasy: "Difficulty: Easy",
                startMission: "Start Mission",
                balanceEnergyEco: "Balance Energy & Ecosystem",
                difficultyMedium: "Difficulty: Medium",
                powerVillage: "Power a Village",
                difficultyHard: "Difficulty: Hard",
                hydroLearningHub: "Hydro Learning Hub",
                learnScience: "Learn the science behind clean energy before starting your missions.",
                whatIsHydropower: "What is Hydropower?",
                hydropowerDesc: "Hydropower is clean energy generated from the force of flowing water. It is a renewable resource that utilizes the natural water cycle.",
                usesOfHydropower: "Uses of Hydropower",
                usesDesc: "Hydropower plays a vital role in providing clean electricity, reducing carbon emissions, and supporting sustainability. It also aids in water management and irrigation.",
                howItWorks: "How It Works?",
                howItWorksDesc: "Water flowing from a height spins a turbine. This turbine is connected to a generator that converts rotational energy into electricity.",
                hydroSimTitle: "Hydropower Simulation",
                hydroSimDesc: "Adjust the water flow speed and see how the turbine spins to generate electricity.",
                waterFlowSpeed: "Water Flow Speed:",
                startSimulation: "Start Simulation",
                stopSimulation: "Stop Simulation",
                electricityOutput: "Electricity Output:",
                kwh: "kWh",
                simulationStarted: "Simulation started! Adjust water flow speed.",
                simulationStopped: "Simulation stopped.",
                futureTechUnlocks: "Future Tech Unlocks",
                unlockInnovative: "Unlock innovative clean energy technology.",
                whatIsAITurbines: "What are AI Turbines?",
                aiTurbinesDesc: "AI Turbines are hydropower turbines equipped with artificial intelligence. AI analyzes water flow data, weather, and energy demand in real-time to optimize turbine performance, maximize electricity production, and minimize environmental impact.",
                aiTurbinesDescShort: "Smart turbines optimizing energy production with AI.",
                whatIsFloatingMicroHydro: "What is Floating Micro-Hydro?",
                floatingMicroHydroDesc: "Floating Micro-Hydro is a small-scale hydropower generation system designed to float on rivers or canals. This technology is ideal for remote communities as it is easy to install, requires minimal infrastructure, and has a very low environmental impact.",
                floatingMicroHydroDescShort: "Floating hydropower for remote communities.",
                aiTurbines: "AI Turbines",
                floatingMicroHydro: "Floating Micro-Hydro",
                sustainabilityScore: "Sustainability Score",
                yourImpact: "Your impact on energy, ecosystem, and community.",
                yourSustainabilityScore: "Your Sustainability Score",
                keepImproving: "Keep improving your positive impact!",
                energyBalance: "Energy Balance",
                ecosystemHealth: "Ecosystem Health",
                communityImpact: "Community Impact",
                optimalTurbine: "Turbine optimization & consumption.",
                minimizeEnvImpact: "Minimize environmental impact.",
                supportCommunity: "Support needs & well-being.",
                topLeaderboard: "Top Leaderboard",
                playerGreat: "Great Player",
                ecoWarrior: "EcoWarrior",
                hydroHero: "HydroHero",
                greenPower: "GreenPower",
                you: "You",
                points: "Points",
                profileUser: "User Profile",
                profileName: "EduHydro Player",
                userLevel: "Level:",
                levelValue: "Hydro Expert",
                sustainabilityPoints: "Sustainability Points:",
                editProfile: "Edit Profile",
                logout: "Logout",
                learningCenter: "Learning Center",
                searchLearningTopics: "Search learning topics...",
                aseanEnergy: "ASEAN & Energy",
                exploreAseanEnergy: "Explore the relationship between energy and sustainability in Southeast Asia.",
                renewableEnergy: "Renewable Energy",
                learnCleanEnergy: "Learn about various clean energy sources and innovations.",
                hydropowerTopic: "Hydropower",
                understandHydropower: "Understand how water generates electricity and its impact.",
                futureTechTopic: "Future Technology",
                learnAITurbines: "Learn about AI Turbines and Floating Micro-Hydro.",
                miniGames: "Interactive Mini-Games",
                damConstructionSim: "Dam Construction Simulation",
                chooseMaterials: "Choose materials, location, and see the impact of water flow on power generation.",
                waterFlowPuzzle: "Water Flow Puzzle",
                guideWater: "Guide water through the correct path to activate turbines and generate electricity.",
                achievementsLevel: "Achievements & Level",
                yourLevel: "Your Level:",
                completeMissions: "Complete missions to level up!",
                yourBadges: "Your Badges",
                riverExplorer: "River Explorer",
                completeQuests: "Complete 3 ASEAN River Quests.",
                energyExpert: "Energy Expert",
                answerQuizzes: "Answer 10 quizzes perfectly.",
                hydroInnovator: "Hydro Innovator",
                unlockAllTech: "Unlock all Future Technologies.",
                unlockables: "Unlockables",
                rainforestTheme: "Rainforest Profile Theme",
                seniorResearcherAvatar: "Senior Researcher Avatar",
                okButton: "OK",
                missionStarted: (missionName) => `Starting mission: "${missionName}"! Good luck!`,
                simulationStartedAlert: "Simulation started! Adjust water flow speed.",
                simulationStoppedAlert: "Simulation stopped.",
                hydraBotTitle: "Hydra Bot",
                hydraBotNav: "Hydra Bot",
                hydraWelcomeMessage: "Hello! I am Hydra, your EduHydro AI bot. Ask me anything about hydropower or ASEAN!",
                askHydraPlaceholder: "Ask Hydra anything...",
                sendButton: "Send",
                hydraTyping: "Hydra is typing...",
                apiError: "Failed to get response from Hydra. Please try again later."
            },
            id: {
                appTitle: "EduHydro",
                tagline: "Main untuk Belajar, Belajar untuk Menggerakkan Masa Depan ASEAN",
                searchPlaceholder: "Cari fitur atau topik...",
                home: "Beranda",
                play: "Main",
                learn: "Belajar",
                profile: "Profil",
                aseanRiverQuest: "Quest Sungai ASEAN",
                exploreRivers: "Jelajahi sungai ikonik ASEAN sambil menyelesaikan tantangan komunitas & lingkungan.",
                mekongRiver: "Sungai Mekong",
                unlocked: "Terbuka",
                locked: "Terkunci",
                startQuest: "Mulai Quest",
                kapuasRiver: "Sungai Kapuas",
                chaoPhrayaRiver: "Sungai Chao Phraya",
                irrawaddyRiver: "Sungai Irrawaddy",
                gameplayTips: "Tips: Seimbangkan produksi energi, ekosistem, dan kebutuhan komunitas untuk memenangkan *quest*.",
                eduplayMissions: "Misi EduPlay",
                gamifiedLearning: "Pembelajaran gamifikasi dengan tugas tenaga air interaktif.",
                buildTurbine: "Bangun Turbin Pertama Anda",
                difficultyEasy: "Tingkat Kesulitan: Mudah",
                startMission: "Mulai Misi",
                balanceEnergyEco: "Seimbangkan Energi & Ekosistem",
                difficultyMedium: "Tingkat Kesulitan: Sedang",
                powerVillage: "Memberi Daya Desa",
                difficultyHard: "Tingkat Kesulitan: Sulit",
                hydroLearningHub: "Pusat Pembelajaran Hidro",
                learnScience: "Pelajari ilmu di balik energi bersih sebelum memulai misi Anda.",
                whatIsHydropower: "Apa itu Hydropower?",
                hydropowerDesc: "Hydropower adalah energi bersih yang dihasilkan dari kekuatan air yang mengalir. Ini adalah sumber daya terbarukan yang memanfaatkan siklus air alami.",
                usesOfHydropower: "Kegunaan Hydropower",
                usesDesc: "Hydropower berperan penting dalam menyediakan listrik bersih, mengurangi emisi karbon, dan mendukung keberlanjutan. Ini juga membantu pengelolaan air dan irigasi.",
                howItWorks: "Bagaimana Cara Kerja?",
                howItWorksDesc: "Air yang mengalir dari ketinggian memutar turbin. Turbin ini terhubung ke generator yang mengubah energi putaran menjadi listrik.",
                hydroSimTitle: "Simulasi Pembangkit Tenaga Air",
                hydroSimDesc: "Atur kecepatan aliran air dan lihat bagaimana turbin berputar untuk menghasilkan listrik.",
                waterFlowSpeed: "Kecepatan Aliran Air:",
                startSimulation: "Mulai Simulasi",
                stopSimulation: "Hentikan Simulasi",
                electricityOutput: "Output Listrik:",
                kwh: "kWh",
                simulationStarted: "Simulasi dimulai! Sesuaikan kecepatan aliran air.",
                simulationStopped: "Simulasi dihentikan.",
                futureTechUnlocks: "Pembuka Teknologi Masa Depan",
                unlockInnovative: "Buka teknologi energi bersih inovatif.",
                whatIsAITurbines: "Apa itu Turbin AI?",
                aiTurbinesDesc: "Turbin AI adalah turbin tenaga air yang dilengkapi dengan kecerdasan buatan. AI menganalisis data aliran air, cuaca, dan permintaan energi secara real-time untuk mengoptimalkan kinerja turbin, memaksimalkan produksi listrik, dan meminimalkan dampak lingkungan.",
                aiTurbinesDescShort: "Turbin pintar yang mengoptimalkan produksi energi dengan AI.",
                whatIsFloatingMicroHydro: "Apa itu Mikro-Hidro Apung?",
                floatingMicroHydroDesc: "Mikro-Hidro Apung adalah sistem pembangkit listrik tenaga air skala kecil yang dirancang untuk mengapung di sungai atau kanal. Teknologi ini ideal untuk komunitas terpencil karena mudah dipasang, minim infrastruktur, dan memiliki dampak lingkungan yang sangat rendah.",
                floatingMicroHydroDescShort: "Pembangkit listrik tenaga air apung untuk komunitas terpencil.",
                aiTurbines: "Turbin AI",
                floatingMicroHydro: "Mikro-Hidro Apung",
                sustainabilityScore: "Skor Keberlanjutan",
                yourImpact: "Dampak Anda pada energi, ekosistem, dan komunitas.",
                yourSustainabilityScore: "Skor Keberlanjutan Anda",
                keepImproving: "Terus tingkatkan dampak positif Anda!",
                energyBalance: "Keseimbangan Energi",
                ecosystemHealth: "Kesehatan Ekosistem",
                communityImpact: "Dampak Komunitas",
                optimalTurbine: "Optimalisasi turbin & konsumsi.",
                minimizeEnvImpact: "Minimalkan dampak lingkungan.",
                supportCommunity: "Dukung kebutuhan & kesejahteraan.",
                topLeaderboard: "Papan Peringkat Teratas",
                playerGreat: "Pemain Hebat",
                ecoWarrior: "EcoWarrior",
                hydroHero: "HydroHero",
                greenPower: "GreenPower",
                you: "Anda",
                points: "Poin",
                profileUser: "Profil Pengguna",
                profileName: "Pemain EduHydro",
                userLevel: "Level:",
                levelValue: "Ahli Hidro",
                sustainabilityPoints: "Poin Keberlanjutan:",
                editProfile: "Edit Profil",
                logout: "Keluar",
                learningCenter: "Pusat Pembelajaran",
                searchLearningTopics: "Cari topik pembelajaran...",
                aseanEnergy: "ASEAN & Energi",
                exploreAseanEnergy: "Jelajahi hubungan energi dan keberlanjutan di Asia Tenggara.",
                renewableEnergy: "Energi Terbarukan",
                learnCleanEnergy: "Pelajari berbagai sumber energi bersih dan inovasinya.",
                hydropowerTopic: "Tenaga Air (Hydropower)",
                understandHydropower: "Pahami bagaimana air menghasilkan listrik dan dampaknya.",
                futureTechTopic: "Teknologi Masa Depan",
                learnAITurbines: "Mengenal Turbin AI dan Mikro-Hidro Apung.",
                miniGames: "Mini-Game Interaktif",
                damConstructionSim: "Simulasi Pembangunan Bendungan",
                chooseMaterials: "Pilih material, lokasi, dan lihat dampak aliran air pada pembangkit listrik.",
                waterFlowPuzzle: "Puzzle Aliran Air",
                guideWater: "Arahkan air melalui jalur yang benar untuk mengaktifkan turbin dan menghasilkan listrik.",
                achievementsLevel: "Prestasi & Level",
                yourLevel: "Level Anda:",
                completeMissions: "Selesaikan misi untuk naik level!",
                yourBadges: "Lencana Anda",
                riverExplorer: "Penjelajah Sungai",
                energyExpert: "Pakar Energi",
                answerQuizzes: "Jawab 10 kuis dengan sempurna.",
                hydroInnovator: "Inovator Hidro",
                unlockAllTech: "Buka semua Teknologi Masa Depan.",
                unlockables: "Yang Bisa Dibuka",
                rainforestTheme: "Tema Profil Hutan Hujan",
                seniorResearcherAvatar: "Avatar Peneliti Senior",
                okButton: "OK",
                missionStarted: (missionName) => `Memulai misi: "${missionName}"! Semoga berhasil!`,
                simulationStartedAlert: "Simulasi dimulai! Sesuaikan kecepatan aliran air.",
                simulationStoppedAlert: "Simulasi dihentikan.",
                hydraBotTitle: "Bot Hydra",
                hydraBotNav: "Bot Hydra",
                hydraWelcomeMessage: "Halo! Saya Hydra, bot AI EduHydro Anda. Tanyakan apa saja tentang energi air atau ASEAN!",
                askHydraPlaceholder: "Tanyakan apa saja kepada Hydra...",
                sendButton: "Kirim",
                hydraTyping: "Hydra sedang mengetik...",
                apiError: "Gagal mendapatkan respons dari Hydra. Silakan coba lagi nanti."
            },
            ms: { // Bahasa Malaysia
                appTitle: "EduHydro",
                tagline: "Bermain untuk Belajar, Belajar untuk Menggerakkan Masa Depan ASEAN",
                searchPlaceholder: "Cari ciri atau topik...",
                home: "Utama",
                play: "Main",
                learn: "Belajar",
                profile: "Profil",
                aseanRiverQuest: "Misi Sungai ASEAN",
                exploreRivers: "Terokai sungai ikonik ASEAN sambil menyelesaikan cabaran komuniti & alam sekitar.",
                mekongRiver: "Sungai Mekong",
                unlocked: "Dibuka Kunci",
                locked: "Dikunci",
                startQuest: "Mula Misi",
                kapuasRiver: "Sungai Kapuas",
                chaoPhrayaRiver: "Sungai Chao Phraya",
                irrawaddyRiver: "Sungai Irrawaddy",
                gameplayTips: "Petua: Seimbangkan pengeluaran tenaga, ekosistem, dan keperluan komuniti untuk memenangi misi.",
                eduplayMissions: "Misi EduPlay",
                gamifiedLearning: "Pembelajaran gamifikasi dengan tugasan hidrokuasa interaktif.",
                buildTurbine: "Bina Turbin Pertama Anda",
                difficultyEasy: "Tahap Kesukaran: Mudah",
                startMission: "Mula Misi",
                balanceEnergyEco: "Seimbangkan Tenaga & Ekosistem",
                difficultyMedium: "Tahap Kesukaran: Sederhana",
                powerVillage: "Menjana Kuasa Kampung",
                difficultyHard: "Tahap Kesukaran: Sukar",
                hydroLearningHub: "Hab Pembelajaran Hidro",
                learnScience: "Pelajari sains di sebalik tenaga bersih sebelum memulakan misi anda.",
                whatIsHydropower: "Apakah itu Hidrokuasa?",
                hydropowerDesc: "Hidrokuasa ialah tenaga bersih yang dihasilkan daripada daya air yang mengalir. Ia adalah sumber yang boleh diperbaharui yang menggunakan kitaran air semula jadi.",
                usesOfHydropower: "Kegunaan Hidrokuasa",
                usesDesc: "Hidrokuasa memainkan peranan penting dalam menyediakan elektrik bersih, mengurangkan pelepasan karbon, dan menyokong kelestarian. Ia juga membantu dalam pengurusan air dan pengairan.",
                howItWorks: "Bagaimana Ia Berfungsi?",
                howItWorksDesc: "Air yang mengalir dari ketinggian memutarkan turbin. Turbin ini disambungkan kepada penjana yang menukar tenaga putaran kepada elektrik.",
                hydroSimTitle: "Simulasi Hidrokuasa",
                hydroSimDesc: "Laraskan kelajuan aliran air dan lihat bagaimana turbin berputar untuk menjana elektrik.",
                waterFlowSpeed: "Kelajuan Aliran Air:",
                startSimulation: "Mula Simulasi",
                stopSimulation: "Henti Simulasi",
                electricityOutput: "Output Elektrik:",
                kwh: "kWh",
                simulationStarted: "Simulasi dimulakan! Laraskan kelajuan aliran air.",
                simulationStopped: "Simulasi dihentikan.",
                futureTechUnlocks: "Pembuka Kunci Teknologi Masa Depan",
                unlockInnovative: "Buka kunci teknologi tenaga bersih inovatif.",
                whatIsAITurbines: "Apakah itu Turbin AI?",
                aiTurbinesDesc: "Turbin AI ialah turbin hidrokuasa yang dilengkapi dengan kecerdasan buatan. AI menganalisis data aliran air, cuaca, dan permintaan tenaga dalam masa nyata untuk mengoptimumkan prestasi turbin, memaksimumkan pengeluaran elektrik, dan meminimumkan kesan alam sekitar.",
                aiTurbinesDescShort: "Turbin pintar mengoptimumkan pengeluaran tenaga dengan AI.",
                whatIsFloatingMicroHydro: "Apakah itu Mikro-Hidro Terapung?",
                floatingMicroHydroDesc: "Mikro-Hidro Terapung ialah sistem penjanaan hidrokuasa berskala kecil yang direka untuk terapung di sungai atau terusan. Teknologi ini sesuai untuk komuniti terpencil kerana mudah dipasang, memerlukan infrastruktur minimum, dan mempunyai kesan alam sekitar yang sangat rendah.",
                floatingMicroHydroDescShort: "Hidrokuasa terapung untuk komuniti terpencil.",
                aiTurbines: "Turbin AI",
                floatingMicroHydro: "Mikro-Hidro Terapung",
                sustainabilityScore: "Skor Kelestarian",
                yourImpact: "Kesan anda terhadap tenaga, ekosistem, dan komuniti.",
                yourSustainabilityScore: "Skor Kelestarian Anda",
                keepImproving: "Terus tingkatkan impak positif anda!",
                energyBalance: "Keseimbangan Tenaga",
                ecosystemHealth: "Kesihatan Ekosistem",
                communityImpact: "Impak Komuniti",
                optimalTurbine: "Pengoptimuman turbin & penggunaan.",
                minimizeEnvImpact: "Minimumkan kesan alam sekitar.",
                supportCommunity: "Sokong keperluan & kesejahteraan.",
                topLeaderboard: "Papan Pendahulu Teratas",
                playerGreat: "Pemain Hebat",
                ecoWarrior: "Pahlawan Alam Sekitar",
                hydroHero: "Wira Hidro",
                greenPower: "Kuasa Hijau",
                you: "Anda",
                points: "Mata",
                profileUser: "Profil Pengguna",
                profileName: "Pemain EduHydro",
                userLevel: "Tahap:",
                levelValue: "Pakar Hidro",
                sustainabilityPoints: "Mata Kelestarian:",
                editProfile: "Edit Profil",
                logout: "Log Keluar",
                learningCenter: "Pusat Pembelajaran",
                searchLearningTopics: "Cari topik pembelajaran...",
                aseanEnergy: "ASEAN & Tenaga",
                exploreAseanEnergy: "Terokai hubungan antara tenaga dan kelestarian di Asia Tenggara.",
                renewableEnergy: "Tenaga Boleh Diperbaharui",
                learnCleanEnergy: "Pelajari pelbagai sumber tenaga bersih dan inovasinya.",
                hydropowerTopic: "Hidrokuasa",
                understandHydropower: "Fahami bagaimana air menjana elektrik dan kesannya.",
                futureTechTopic: "Teknologi Masa Depan",
                learnAITurbines: "Pelajari tentang Turbin AI dan Mikro-Hidro Terapung.",
                miniGames: "Permainan Mini Interaktif",
                damConstructionSim: "Simulasi Pembinaan Empangan",
                chooseMaterials: "Pilih bahan, lokasi, dan lihat kesan aliran air pada penjanaan kuasa.",
                waterFlowPuzzle: "Teka-teki Aliran Air",
                guideWater: "Pandu air melalui laluan yang betul untuk mengaktifkan turbin dan menjana elektrik.",
                achievementsLevel: "Pencapaian & Tahap",
                yourLevel: "Tahap Anda:",
                completeMissions: "Selesaikan misi untuk naik tahap!",
                yourBadges: "Lencana Anda",
                riverExplorer: "Penjelajah Sungai",
                completeQuests: "Selesaikan 3 Misi Sungai ASEAN.",
                energyExpert: "Pakar Tenaga",
                answerQuizzes: "Jawab 10 kuiz dengan sempurna.",
                hydroInnovator: "Inovator Hidro",
                unlockAllTech: "Buka kunci semua Teknologi Masa Depan.",
                unlockables: "Boleh Dibuka Kunci",
                rainforestTheme: "Tema Profil Hutan Hujan",
                seniorResearcherAvatar: "Avatar Penyelidik Kanan",
                okButton: "OK",
                missionStarted: (missionName) => `Memulakan misi: "${missionName}"! Semoga berjaya!`,
                simulationStartedAlert: "Simulasi dimulakan! Laraskan kelajuan aliran air.",
                simulationStoppedAlert: "Simulasi dihentikan.",
                hydraBotTitle: "Bot Hydra",
                hydraBotNav: "Bot Hydra",
                hydraWelcomeMessage: "Hello! Saya Hydra, bot AI EduHydro anda. Tanya saya apa sahaja tentang tenaga hidro atau ASEAN!",
                askHydraPlaceholder: "Tanya Hydra apa sahaja...",
                sendButton: "Hantar",
                hydraTyping: "Hydra sedang menaip...",
                apiError: "Gagal mendapatkan respons daripada Hydra. Sila cuba lagi nanti."
            }
        };

        let currentLanguage = 'en'; // Default language
        let chatHistory = []; // Stores chat messages for Gemini API

        document.addEventListener('DOMContentLoaded', () => {
            const homeSection = document.getElementById('home-section');
            const learnSection = document.getElementById('learn-section');
            const profileSection = document.getElementById('profile-section');
            const miniGamesSection = document.getElementById('mini-games-section');
            const achievementsSection = document.getElementById('achievements-section');
            const aseanRiverQuestSection = document.getElementById('asean-river-quest-section'); 
            const eduplayMissionsSection = document.getElementById('eduplay-missions-section');
            const hydroLearningHubSection = document.getElementById('hydro-learning-hub-section'); 
            const futureTechUnlocksSection = document.getElementById('future-tech-unlocks-section');
            const sustainabilityScoreSection = document.getElementById('sustainability-score-section');
            const hydraBotSection = document.getElementById('hydra-bot-section'); // New Hydra Bot section

            const headerSearchBar = document.getElementById('header-search-bar');
            const headerSearchBarContainer = document.getElementById('header-search-bar-container');

            const learnSearchBar = document.getElementById('learn-search-bar');
            const categoryCards = document.querySelectorAll('#learn-section .category-card'); 

            const navItems = document.querySelectorAll('.nav-item');
            const featureCards = document.querySelectorAll('.feature-card'); 
            const missionCards = document.querySelectorAll('#eduplay-missions-section .mission-card'); 

            const languageSelector = document.getElementById('language-selector');

            // Simulation elements for Hydro Learning Hub
            const waterFlowSpeedSlider = document.getElementById('water-flow-speed');
            const kwhOutputSpan = document.getElementById('kwh-output');
            const startSimulationButton = document.getElementById('start-simulation');
            let simulationInterval;

            // Hydra Bot elements
            const chatMessagesContainer = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const loadingIndicator = document.getElementById('loading-indicator');

            // Function to show custom alert modal
            function showCustomAlert(messageKey, isDynamic = false, dynamicValue = '') {
                const modal = document.getElementById('custom-alert-modal');
                const msgElement = document.getElementById('alert-message');
                const okButton = document.getElementById('alert-ok-button');

                let message;
                if (isDynamic && typeof languageData[currentLanguage][messageKey] === 'function') {
                    message = languageData[currentLanguage][messageKey](dynamicValue);
                } else {
                    message = languageData[currentLanguage][messageKey] || messageKey; // Fallback to key if not found
                }
                
                msgElement.textContent = message;
                okButton.textContent = languageData[currentLanguage].okButton; // Ensure OK button is translated
                modal.classList.add('show');

                okButton.onclick = () => {
                    modal.classList.remove('show');
                };
            }

            // Function to apply translations
            function switchLanguage(lang) {
                currentLanguage = lang;
                const translations = languageData[lang];

                // Update title
                document.querySelector('title').textContent = translations.appTitle;

                // Update elements with data-lang-key
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[key]) {
                        element.textContent = translations[key];
                    }
                });

                // Update input placeholders
                document.querySelectorAll('[data-lang-placeholder-key]').forEach(element => {
                    const key = element.dataset.langPlaceholderKey;
                    if (translations[key]) {
                        element.placeholder = translations[key];
                    }
                });

                // Update specific elements that might not be directly in data-lang-key
                document.getElementById('start-simulation').textContent = translations.startSimulation;
                if (simulationInterval) { // If simulation is running, update button to 'Stop'
                    document.getElementById('start-simulation').textContent = translations.stopSimulation;
                }
            }

            // Function to hide all main content sections
            function hideAllSections() {
                homeSection.style.display = 'none';
                learnSection.style.display = 'none';
                profileSection.style.display = 'none';
                miniGamesSection.style.display = 'none';
                achievementsSection.style.display = 'none';
                aseanRiverQuestSection.style.display = 'none'; 
                eduplayMissionsSection.style.display = 'none';
                hydroLearningHubSection.style.display = 'none'; 
                futureTechUnlocksSection.style.display = 'none';
                sustainabilityScoreSection.style.display = 'none';
                hydraBotSection.style.display = 'none'; // Hide Hydra Bot section
                
                // Stop simulation when leaving Hydro Learning Hub
                clearInterval(simulationInterval);
                kwhOutputSpan.textContent = '0';
                startSimulationButton.textContent = languageData[currentLanguage].startSimulation; // Reset button text
                waterFlowSpeedSlider.disabled = true; // Disable slider
            }

            // Function to show a specific section
            function showSection(sectionElement) {
                hideAllSections();
                // Remove active class from all nav items
                navItems.forEach(item => item.classList.remove('active'));

                if (sectionElement === homeSection) {
                    homeSection.style.display = 'grid'; 
                    headerSearchBarContainer.style.display = 'flex'; 
                    document.querySelector('.nav-item[data-section="home-section"]').classList.add('active');
                } else if (sectionElement === learnSection) {
                    learnSection.style.display = 'block'; 
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="learn-section"]').classList.add('active');
                } else if (sectionElement === profileSection) {
                    profileSection.style.display = 'block'; 
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="profile-section"]').classList.add('active');
                } else if (sectionElement === miniGamesSection) {
                    miniGamesSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="eduplay-missions-section"]').classList.add('active'); // Keep Play active
                } else if (sectionElement === achievementsSection) {
                    achievementsSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="profile-section"]').classList.add('active'); 
                } 
                else if (sectionElement === aseanRiverQuestSection) { 
                    aseanRiverQuestSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="eduplay-missions-section"]').classList.add('active'); // "Play" is active
                } else if (sectionElement === eduplayMissionsSection) { 
                    eduplayMissionsSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="eduplay-missions-section"]').classList.add('active'); // "Play" is active
                } else if (sectionElement === hydroLearningHubSection) { 
                    hydroLearningHubSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="learn-section"]').classList.add('active'); // "Learn" is active
                } else if (sectionElement === futureTechUnlocksSection) { 
                    futureTechUnlocksSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="learn-section"]').classList.add('active'); // "Learn" is active, as it's a knowledge-based unlock
                } else if (sectionElement === sustainabilityScoreSection) { 
                    sustainabilityScoreSection.style.display = 'block';
                    headerSearchBarContainer.style.display = 'none'; 
                    document.querySelector('.nav-item[data-section="profile-section"]').classList.add('active'); // "Profile" is active, as it's related to user progress
                } else if (sectionElement === hydraBotSection) { // Show Hydra Bot section
                    hydraBotSection.style.display = 'flex'; // Use flex for chat layout
                    headerSearchBarContainer.style.display = 'none';
                    document.querySelector('.nav-item[data-section="hydra-bot-section"]').classList.add('active');
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Scroll to bottom
                }
            }

            // Initial load: show home section and apply default language
            showSection(homeSection);
            switchLanguage(currentLanguage); // Apply English by default

            // Add click listeners to navbar items
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSectionId = item.dataset.section;

                    if (targetSectionId === 'home-section') {
                        showSection(homeSection);
                    } else if (targetSectionId === 'learn-section') {
                        showSection(learnSection);
                    } else if (targetSectionId === 'profile-section') {
                        showSection(profileSection);
                    } else if (targetSectionId === 'eduplay-missions-section') {
                        showSection(eduplayMissionsSection);
                    } else if (targetSectionId === 'hydra-bot-section') {
                        showSection(hydraBotSection);
                    }
                });
            });

            // Add click listener for "ASEAN River Quest" card in Home to show its section
            const aseanRiverQuestCard = document.querySelector('[data-feature="asean-river-quest-section"]');
            if (aseanRiverQuestCard) {
                aseanRiverQuestCard.addEventListener('click', () => {
                    showSection(aseanRiverQuestSection);
                });
            }

            // Add click listener for "EduPlay Missions" card in Home to show its section
            const eduPlayMissionsCard = document.querySelector('[data-feature="eduplay-missions-section"]');
            if (eduPlayMissionsCard) {
                eduPlayMissionsCard.addEventListener('click', () => {
                    showSection(eduplayMissionsSection);
                });
            }

            // Add click listener for "Hydro Learning Hub" card in Home to show its section
            const hydroLearningHubCard = document.querySelector('[data-feature="hydro-learning-hub-section"]');
            if (hydroLearningHubCard) {
                hydroLearningHubCard.addEventListener('click', () => {
                    showSection(hydroLearningHubSection);
                });
            }

            // Add click listener for "Future Tech Unlocks" card in Home to show its section
            const futureTechUnlocksCard = document.querySelector('[data-feature="future-tech-unlocks-section"]');
            if (futureTechUnlocksCard) {
                futureTechUnlocksCard.addEventListener('click', () => {
                    showSection(futureTechUnlocksSection);
                });
            }

            // Add click listener for "Sustainability Score" card in Home to show its section
            const sustainabilityScoreCard = document.querySelector('[data-feature="sustainability-score-section"]');
            if (sustainabilityScoreCard) {
                sustainabilityScoreCard.addEventListener('click', () => {
                    showSection(sustainabilityScoreSection);
                });
            }

            // Add click listeners to "Start Mission" buttons within EduPlay Missions section
            missionCards.forEach(button => {
                button.addEventListener('click', () => {
                    const missionName = button.closest('.mission-card').querySelector('h3').textContent;
                    showCustomAlert('missionStarted', true, missionName); // Use dynamic message
                });
            });

            // Hydro Learning Hub Simulation Logic
            function updateSimulationOutput() {
                const flowSpeed = parseInt(waterFlowSpeedSlider.value);
                // Simple linear relationship for demonstration
                const generatedKwh = Math.floor(flowSpeed * 0.5); 
                kwhOutputSpan.textContent = generatedKwh;
            }

            startSimulationButton.addEventListener('click', () => {
                if (startSimulationButton.textContent === languageData[currentLanguage].startSimulation) {
                    showCustomAlert('simulationStartedAlert');
                    startSimulationButton.textContent = languageData[currentLanguage].stopSimulation;
                    waterFlowSpeedSlider.disabled = false;
                    simulationInterval = setInterval(updateSimulationOutput, 200); // Update every 200ms
                } else {
                    showCustomAlert('simulationStoppedAlert');
                    startSimulationButton.textContent = languageData[currentLanguage].startSimulation;
                    waterFlowSpeedSlider.disabled = true;
                    clearInterval(simulationInterval);
                    kwhOutputSpan.textContent = '0';
                    waterFlowSpeedSlider.value = '0'; // Reset slider
                }
            });

            waterFlowSpeedSlider.addEventListener('input', updateSimulationOutput);
            waterFlowSpeedSlider.disabled = true; // Disable slider initially

            // Language selector change listener
            languageSelector.addEventListener('change', (e) => {
                switchLanguage(e.target.value);
            });

            // Header search bar functionality to filter feature cards
            headerSearchBar.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                showSection(homeSection); // Always switch to home when header search is used

                featureCards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();

                    if (title.includes(query) || description.includes(query)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });

            // Learn section search bar functionality to filter category cards
            learnSearchBar.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                
                categoryCards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();

                    if (title.includes(query) || description.includes(query)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });

            // --- Hydra Bot Logic ---

            // Function to add a message to the chat display
            function addMessageToChat(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-message', sender);

                const avatarDiv = document.createElement('div');
                avatarDiv.classList.add('message-avatar');
                avatarDiv.textContent = sender === 'user' ? '' : '';

                const contentDiv = document.createElement('div');
                contentDiv.classList.add('message-content');
                contentDiv.textContent = message;

                if (sender === 'user') {
                    messageDiv.appendChild(contentDiv);
                    messageDiv.appendChild(avatarDiv);
                } else {
                    messageDiv.appendChild(avatarDiv);
                    messageDiv.appendChild(contentDiv);
                }
                chatMessagesContainer.appendChild(messageDiv);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Auto-scroll to bottom
            }

            // Function to call Gemini API with exponential backoff
            async function callGeminiAPI(prompt, retries = 0) {
                const maxRetries = 5;
                const baseDelay = 1000; // 1 second

                try {
                    loadingIndicator.style.display = 'block'; // Show loading indicator
                    sendButton.disabled = true; // Disable send button

                    let chatHistoryForAPI = [];
                    // Only send the last few messages to keep context relevant and within token limits
                    const recentHistory = chatHistory.slice(-5); // Adjust as needed
                    recentHistory.forEach(msg => {
                        chatHistoryForAPI.push({ role: msg.sender === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] });
                    });
                    chatHistoryForAPI.push({ role: "user", parts: [{ text: prompt }] });

                    const payload = { contents: chatHistoryForAPI };
                    const apiKey = ""; // Canvas will provide this at runtime
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return languageData[currentLanguage].apiError; // Generic error message
                    }
                } catch (error) {
                    console.error('API call failed:', error);
                    if (retries < maxRetries) {
                        const delay = baseDelay * Math.pow(2, retries);
                        console.log(`Retrying in ${delay / 1000} seconds... (Attempt ${retries + 1})`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return callGeminiAPI(prompt, retries + 1); // Retry with incremented retry count
                    } else {
                        return languageData[currentLanguage].apiError;
                    }
                } finally {
                    loadingIndicator.style.display = 'none'; // Hide loading indicator
                    sendButton.disabled = false; // Enable send button
                }
            }

            // Function to handle sending a message
            async function sendMessage() {
                const userMessage = chatInput.value.trim();
                if (userMessage === '') return;

                addMessageToChat(userMessage, 'user');
                chatHistory.push({ sender: 'user', text: userMessage });
                chatInput.value = ''; // Clear input

                const botResponse = await callGeminiAPI(userMessage);
                addMessageToChat(botResponse, 'bot');
                chatHistory.push({ sender: 'bot', text: botResponse });
            }

            // Event listeners for Hydra Bot
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { // Send on Enter, allow Shift+Enter for new line
                    e.preventDefault(); // Prevent new line in textarea
                    sendMessage();
                }
            });

            // Adjust textarea height dynamically
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = (chatInput.scrollHeight) + 'px';
            });
        });
    </script>
</body>
</html>
